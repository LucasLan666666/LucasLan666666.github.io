# 第零章：frp 项目的简介

frp 是一个用于内网穿透的反向代理应用，可以将内网服务以安全、便捷的方式通过具有公网 IP 节点的中转暴露到公网。

## 项目背景

### 为什么需要内网穿透？

在日常工作中，我们经常会遇到需要将内网服务暴露到公网的需求，例如：

- 建网站
- 做调试
- 开游戏
- ...

但是，由于 **ipv4 地址资源有限**，绝大多数内网环境并没有公网 IP，再加上 **ipv6 普及进程缓慢**，导致了内网服务无法直接暴露到公网的情况。

因此，需要一种技术手段，将内网服务通过具有公网 IP 的节点中转，从而解决没有公网 IP 的难题，这就是内网穿透技术。

### 什么是反向代理？

反向代理是一种位于服务器和客户端之间的代理服务器。客户端将请求发送给反向代理，然后由代理服务器根据一定的规则将请求转发给后端服务器。后端服务器将响应返回给代理服务器，再由代理服务器将响应转发给客户端。

![reverse_proxy](assets/reverse_proxy.png)

反向代理的优势在于：

- **负载均衡**，提高系统的整体性能和稳定性。
- 隐藏真实服务器的信息，提高**安全性**。
- 缓存静态资源，减少后端服务器的负载，提高**响应速度**。

## frp 主要功能说明

通过在具有公网 IP 的节点上部署 frp 服务端，从而将内网服务穿透到公网。此外还提供诸多专业功能特性：

- 客户端服务端通信支持 TCP、QUIC、KCP 以及 Websocket 等多种协议。
- 采用 TCP 连接流式复用，在单个连接间承载更多请求，节省连接建立时间，降低请求延迟。
- 代理组间的负载均衡。
- 端口复用，多个服务通过同一个服务端端口暴露。
- 支持 P2P 通信，流量不经过服务器中转，充分利用带宽资源。
- 多个原生支持的客户端插件（静态文件查看，HTTPS/HTTP 协议转换，HTTP、SOCK5 代理等），便于独立使用 frp 客户端完成某些工作。
- 高度扩展性的服务端插件系统，易于结合自身需求进行功能扩展。
- 服务端和客户端 UI 页面。

## 工作流程简述

![architecture](assets/architecture.png)

1. **配置服务器端（frps）**：
    - 在公网服务器上部署并运行 frps，配置好 `frps.ini` 文件，设置端口、token、通信加密等参数。
    - frps 会监听指定端口，等待来自 frpc 客户端的连接请求。

2. **配置客户端（frpc）**：
    - 在内网机器上部署并运行 frpc，配置好 `frpc.ini` 文件，指定连接的服务器地址、端口、token 等信息。
    - frpc 会连接 frps 服务器，并注册自己的服务信息。

3. **服务映射**：
    - 在 frpc 配置文件中设置需要映射到公网的服务端口，如将内网的 80 端口映射到公网的 6000 端口。
    - 当有公网用户访问 frps 服务器的 6000 端口时，请求会被转发到内网机器的 80 端口。

4. **建立连接**：
    - frpc 会定时向 frps 发送心跳包以保持连接。
    - 当有外部请求到达 frps，frps 将请求转发给合适的 frpc 客户端，再由 frpc 将请求转发到内网的目标服务。

5. **数据传输**：
    - 通过 frp 的转发，可以实现外部用户访问内网的服务，实现内网穿透的效果。
    - 所有数据经过 frp 的传输都可以进行加密，保证传输安全。
